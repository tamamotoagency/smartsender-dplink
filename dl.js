var ssDeepLink=function(selector,domain,query=false,params={}){let config={context:{range:[],scope:{},variables:{},},messengers:[{key:'?',name:'telegram',parameter:'start',prefixes:['tg://','https://t.me/'],},{key:'?',name:'facebook',parameter:'ref',prefixes:['https://m.me/'],},{key:'?',name:'instagram',parameter:'ref',prefixes:['https://ig.me/'],},{key:'#',name:'vkontakte',parameter:'r',prefixes:['https://vk.com/','vk://'],},{key:'?',name:'viber',parameter:'context',prefixes:['viber://'],},{key:'?',name:'wa',parameter:'text',prefixes:['https://wa.me','whatsapp://'],},],delimiter:'|',url:'https://'+domain+'.customer.smartsender.eu/api/i/store',};Array.from(document.getElementsByClassName(selector)).forEach(function(element){element.addEventListener('click',function(event){event.preventDefault();resolve(element.getAttribute('href'));});});function resolve(url){let xhr=new XMLHttpRequest();xhr.open('POST',config.url);xhr.setRequestHeader("Content-type","application/json");xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.onreadystatechange=function(){if(this.readyState===4&&this.status===200){let store=JSON.parse(this.responseText);location.href=redirectTo(url,store);}};xhr.send(createContext(params));}
function createContext(params){Object.keys(config.context).forEach(function(key){if(Object.keys(params).includes(key)){return;}
params[key]={};});return JSON.stringify(query?withQueryParameters(params):params);}
function redirectTo(url,store){let messenger=config.messengers.find(function(messenger){return messenger.prefixes.find(function(prefix){return 0===url.indexOf(prefix);});});if(!messenger)return url;let context=url.split(messenger.key);let parts=context[1].split('&');parts.forEach(function(value,index){let pair=value.split('=');if(messenger.parameter===pair[0]){if(messenger.name==='wa'){let pair2=pair[1].split('+');let n=pair2.length;let formattedValue=pair[1].replace(pair2[(n-1)],btoa(atob(pair2[(n-1)])+config.delimiter+store.id).replace(/=/g,''));parts.splice(index,1,[messenger.parameter,formattedValue].join('='));}else{let formattedValue=btoa(atob(pair[1])+config.delimiter+store.id).replace(/=/g,'');parts.splice(index,1,[messenger.parameter,formattedValue].join('='));}}});return context[0]+messenger.key+parts.join('&');}
function withQueryParameters(scope){let params=new URLSearchParams(window.location.search);params.forEach(function(value,key){if(scope.variables.hasOwnProperty(key)){return;}
scope.variables[key]=value;});return scope;}};
